Function.prototype.bind=function(a){var g=this;return function(){return g.apply(a,arguments)}};$.fn.check=function(a){if("undefined"==typeof a)return!!this.attr("checked");var g=this[0].getAttribute("checked");"not"==a?g?this[0].removeAttribute("checked"):this[0].setAttribute("checked","checked"):a?this.attr("checked","checked"):this.removeAttr("checked");return this};
$.fn.disableOnSubmit=function(a){var g=null==a?"input[type=submit],input[type=button],input[type=reset],button":a;$(this).find(g).removeAttr("disabled");$(this).submit(function(){$(this).find(g).attr("disabled","disabled")});return this};var browser={ie:"\v"=="v",moz:"mozInnerScreenX"in window,webkit:"webkitConvertPointFromNodeToPage"in window,pc:!("ontouchstart"in document),local:/^(192\.168\.|127\.0\.0\.1|10\.0\.2\.)/.test(document.domain)};browser.pc=browser.pc||browser.moz||browser.ie;
browser.ios=browser.webkit&&/iPhone|iPad|iPod/.test(navigator.platform)&&"ongesturestart"in document;browser.android=browser.webkit&&/Linux/.test(navigator.platform)&&!browser.pc&&!browser.ios;browser.android?browser.ver=/Android ([\d\.]+)/.test(navigator.userAgent)?parseFloat(RegExp.$1):0:browser.ios&&(browser.ver=/iPhone OS ([\d_]+)/.test(navigator.userAgent)?parseFloat(RegExp.$1.replace(/_/,".")):0);
var GrandBlaze=function(){var a=this;$(function(){GrandBlaze.prototype.onReady.apply(a)});$(window).bind("load",function(){GrandBlaze.prototype.onLoad.apply(a)});this.init();return this};
GrandBlaze.prototype={init:function(){this.zoom=1;if(browser.ios)document.write("<style>header{ -webkit-transform:translateZ(0);} footer{ -webkit-transform:translateZ(0);} .container{-webkit-transform:translateZ(0);}</style>");else if(browser.android&&browser.ver>=2.2&&window.innerWidth!=320){var a=(window.innerWidth-1)/320;document.write("<style>:root{zoom:"+a+";}</style>");this.zoom=a}},onReady:function(){showhelp="";showitem=-1;$("section.dialog-base").dialog({bgiframe:true,autoOpen:false,width:browser.pc?
680:320,modal:true,height:browser.pc?600:320,buttons:{"\u9589\u3058\u308b":function(){$(this).dialog("close")}}});$('input[type="button"].dialog-open').click(function(){var a=$(this).data("dialog"),d=$(this).data("return_id"),b=$(this).data("return_value"),c=$(this).data("return_count"),e=$(this).data("return_money"),f=$(this).data("title"),a=$("#dialog-"+a);a.find('input[type="hidden"].ret_id').val(d);a.find('input[type="hidden"].ret_value').val(b);c!=null&&a.find('input[type="hidden"].ret_count').val(c);
e!=null&&a.find('input[type="hidden"].ret_money').val(e);f!=null&&a.dialog("option","title",f);a.dialog("open")});$("a.apply-link").click(this.applyLink);$("form").disableOnSubmit();$("#itemdata a").each(function(a){$(this).click(function(){var d=$(this).data("viewer"),b=$("#itemdata"),c=b.find("tbody");if(d=="all")c.find("tr").show();else{c.find("tr."+d).show();c.find("tr:not(."+d+")").hide()}d=b.find("li");d.attr("class","ui-state-default ui-corner-top");d.eq(a).attr("class","ui-state-default ui-corner-top ui-tabs-selected ui-state-active")})});
$("#prvdata a").each(function(a){$(this).click(function(){var d=$(this).data("viewer"),b=$("#prvdata"),c=b.find("tbody");if(d=="all")c.find("tr").show();else{c.find("tr."+d).show();c.find("tr:not(."+d+")").hide()}d=b.find("li");d.attr("class","ui-state-default ui-corner-top");d.eq(a).attr("class","ui-state-default ui-corner-top ui-tabs-selected ui-state-active")})});$("#keydata a").each(function(a){$(this).click(function(){var d=$(this).data("viewer"),b=$("#keydata"),c=b.find("tbody");if(d=="all")c.find("tr").show();
else{c.find("tr."+d).show();c.find("tr:not(."+d+")").hide()}d=b.find("li");d.attr("class","ui-state-default ui-corner-top");d.eq(a).attr("class","ui-state-default ui-corner-top ui-tabs-selected ui-state-active")})});$("#compque").button({text:true}).click(function(){$("#compquelist").toggle("fast")});$("table.list_data").find("tbody").find("tr").click(function(){var a=$(this).index();$("table.list_data").find("tbody").find("tr").find("div.toolhelp").hide();var d=$(this).find("div.toolhelp");d.toggle();
if(a==showitem){showitem=-1;d.hide()}else showitem=a});var a=$("div.form-widget");a.click(function(){$("div.help").hide()});a.find("a.help").click(function(a){$("div.help").hide();var d=$(this).data("help"),b=$("#help-"+d);b.toggle();if(d==showhelp){showhelp="";b.hide()}else showhelp=d;grb.stopPropagation(a||window.event)});$("#id_quest_id").change(this.markAjax);$("#btactlist").find("div.form-widget").formset({addText:"\u884c\u306e\u8ffd\u52a0",deleteText:"\u884c\u524a\u9664",addCssClass:"addbtlist",
deleteCssClass:"deletebtlist",maxList:10,added:function(a){$("a.deletebtlist").button({icons:{primary:"ui-icon-circle-minus"},text:true});for(var d=parseInt($("#id_form-TOTAL_FORMS").val()),b=$("#btactlist").children("div"),c=0,e=0;e<d;e++){var f=b.eq(e);f.find("span.action_no").text(c+1);var h=f.children("div").eq(0),j=f.children("div").eq(1);h.find("a.help").attr("data-help",parseInt(e)+"-action_target");h.find("div.help").attr("id","help-"+parseInt(e)+"-action_target");j.find("a.help").attr("data-help",
parseInt(e)+"-action");j.find("div.help").attr("id","help-"+parseInt(e)+"-action");f=f.find('input:hidden[id $= "-DELETE"]');(!f.length||f.val()!="on")&&c++}$("input:button.dialog-open").val("\u9078\u629e");d>=9&&$("a.addbtlist").hide();$(a).find("div.value").find("span").text("");$("#btactlist").sortable({cursor:"move",opacity:0.7,axis:"y",placeholder:"ui-state-highlight",forcePlaceholderSize:true,update:function(){var a=$(".dynamic-form").not(".formset-custom-template");$("#id_form-TOTAL_FORMS").val(a.length);
for(var b=$("#btactlist").children("div"),c=0,d=0,g=a.length;d<g;d++){var e=b.eq(d);e.find("span.action_no").text(c+1);var f=e.children("div").eq(0),h=e.children("div").eq(1);f.find("a.help").attr("data-help",parseInt(d)+"-action_target");f.find("div.help").attr("id","help-"+parseInt(d)+"-action_target");h.find("a.help").attr("data-help",parseInt(d)+"-action");h.find("div.help").attr("id","help-"+parseInt(d)+"-action");h.find("div.help").attr("id","help-"+parseInt(d)+"-action");e=e.find('input:hidden[id $= "-DELETE"]');
(!e.length||e.val()!="on")&&c++;a.eq(d).find("input,select,textarea,label,span").each(function(){grb.updateElementIndex($(this),"form",d)})}}})},removed:function(){for(var a=parseInt($("#id_form-TOTAL_FORMS").val()),d=$("#btactlist").children("div"),b=0;b<a;b++){var c=d.eq(b);c.find("span.action_no").text(b+1);var e=c.children("div").eq(0),c=c.children("div").eq(1);e.find("a.help").attr("data-help",parseInt(b)+"-action_target");e.find("div.help").attr("id","help-"+parseInt(b)+"-action_target");c.find("a.help").attr("data-help",
parseInt(b)+"-action");c.find("div.help").attr("id","help-"+parseInt(b)+"-action");$("a.addbtlist").show()}}});$("#btactlist").sortable({cursor:"move",opacity:0.7,axis:"y",placeholder:"ui-state-highlight",forcePlaceholderSize:true,update:function(){var a=$(".dynamic-form").not(".formset-custom-template");$("#id_form-TOTAL_FORMS").val(a.length);for(var d=$("#btactlist").children("div"),b=0,c=a.length;b<c;b++)a.eq(b).find("input,select,textarea,label,span").each(function(){var c=d.eq(b);c.find("span.action_no").text(b+
1);var f=c.children("div").eq(0),c=c.children("div").eq(1);f.find("a.help").attr("data-help",parseInt(b)+"-action_target");f.find("div.help").attr("id","help-"+parseInt(b)+"-action_target");c.find("a.help").attr("data-help",parseInt(b)+"-action");c.find("div.help").attr("id","help-"+parseInt(b)+"-action");a.eq(b).find("input,select,textarea,label,span").each(function(){grb.updateElementIndex($(this),"form",b)})})}});$("#iclist").find("div.form-widget").formset({addText:"\u884c\u306e\u8ffd\u52a0",
deleteText:"\u884c\u524a\u9664",addCssClass:"addbtlist",deleteCssClass:"deletebtlist",added:function(){$("a.deletebtlist").button({icons:{primary:"ui-icon-circle-minus"},text:true});for(var a=parseInt($("#id_form-TOTAL_FORMS").val()),d=$("#iclist").children("div"),b=0;b<a;b++){var c=d.eq(b);c.find("span.icon_no").text(b+1);var e=c.children("div").eq(0),c=c.children("div").eq(1);e.find("a.help").attr("data-help",parseInt(b)+"-icon_url");e.find("div.help").attr("id","help-"+parseInt(b)+"-icon_url");
c.find("a.help").attr("data-help",parseInt(b)+"-icon_copyright");c.find("div.help").attr("id","help-"+parseInt(b)+"-icon_copyright")}a>=49&&$("a.addbtlist").hide()},removed:function(){for(var a=parseInt($("#id_form-TOTAL_FORMS").val()),d=$("#iclist").children("div"),b=0;b<a;b++){var c=d.eq(b);c.find("span.icon_no").text(b+1);var e=c.children("div").eq(0),c=c.children("div").eq(1);e.find("a.help").attr("data-help",parseInt(b)+"-icon_url");e.find("div.help").attr("id","help-"+parseInt(b)+"-icon_url");
c.find("a.help").attr("data-help",parseInt(b)+"-icon_copyright");c.find("div.help").attr("id","help-"+parseInt(b)+"-icon_copyright");$("a.addbtlist").show()}}});$("#mslist").find("div.form-widget").formset({addText:"\u884c\u306e\u8ffd\u52a0",deleteText:"\u884c\u524a\u9664",addCssClass:"addbtlist",deleteCssClass:"deletebtlist",added:function(a){a.find("select").val("0");a.find("text").val("");a.find("textarea").val("");$("a.deletebtlist").button({icons:{primary:"ui-icon-circle-minus"},text:true});
for(var a=parseInt($("#id_form-TOTAL_FORMS").val()),d=$("#mslist").children("div"),b=0;b<a;b++){var c=d.eq(b);c.find("span.mes_no").text(b+1);var e=c.children("div").eq(0),f=c.children("div").eq(1),c=c.children("div").eq(2);e.find("a.help").attr("data-help",parseInt(b)+"-message_target");e.find("div.help").attr("id","help-"+parseInt(b)+"-message_target");f.find("a.help").attr("data-help",parseInt(b)+"-message_entry");f.find("div.help").attr("id","help-"+parseInt(b)+"-message_entry");c.find("a.help").attr("data-help",
parseInt(b)+"-message_body");c.find("div.help").attr("id","help-"+parseInt(b)+"-message_body")}},removed:function(){for(var a=parseInt($("#id_form-TOTAL_FORMS").val()),d=$("#mslist").children("div"),b=0;b<a;b++){var c=d.eq(b);c.find("span.mes_no").text(b+1);var e=c.children("div").eq(0),f=c.children("div").eq(1),c=c.children("div").eq(2);e.find("a.help").attr("data-help",parseInt(b)+"-message_target");e.find("div.help").attr("id","help-"+parseInt(b)+"-message_target");f.find("a.help").attr("data-help",
parseInt(b)+"-message_entry");f.find("div.help").attr("id","help-"+parseInt(b)+"-message_entry");c.find("a.help").attr("data-help",parseInt(b)+"-message_body");c.find("div.help").attr("id","help-"+parseInt(b)+"-message_body");$("a.addbtlist").show()}}});$("#sflist").find("div.form-widget").formset({addText:"\u884c\u306e\u8ffd\u52a0",deleteText:"\u884c\u524a\u9664",addCssClass:"addbtlist",deleteCssClass:"deletebtlist",added:function(a){$("a.deletebtlist").button({icons:{primary:"ui-icon-circle-minus"},
text:true});for(var d=parseInt($("#id_form-TOTAL_FORMS").val()),b=$("#sflist").children("div"),c=0;c<d;c++){var e=b.eq(c);e.find("span.word_no").text(c+1);var f=e.children("div").eq(0),h=e.children("div").eq(1),e=e.children("div").eq(2);f.find("a.help").attr("data-help",parseInt(c)+"-situation_id");f.find("div.help").attr("id","help-"+parseInt(c)+"-situation_id");h.find("a.help").attr("data-help",parseInt(c)+"-perks_id");h.find("div.help").attr("id","help-"+parseInt(c)+"-perks_id");e.find("a.help").attr("data-help",
parseInt(c)+"-serif_text");e.find("div.help").attr("id","help-"+parseInt(c)+"-serif_text")}$("input:button.dialog-open").val("\u9078\u629e");$(a).find("div.value span").text("");$(a).find("textarea").val("")},removed:function(){for(var a=parseInt($("#id_form-TOTAL_FORMS").val()),d=$("#sflist").children("div"),b=0;b<a;b++){var c=d.eq(b);c.find("span.word_no").text(b+1);var e=c.children("div").eq(0),f=c.children("div").eq(1),c=c.children("div").eq(2);e.find("a.help").attr("data-help",parseInt(b)+"-situation_id");
e.find("div.help").attr("id","help-"+parseInt(b)+"-situation_id");f.find("a.help").attr("data-help",parseInt(b)+"-perks_id");f.find("div.help").attr("id","help-"+parseInt(b)+"-perks_id");c.find("a.help").attr("data-help",parseInt(b)+"-serif_text");c.find("div.help").attr("id","help-"+parseInt(b)+"-serif_text");$("a.addbtlist").show()}}});$("a.addbtlist").button({icons:{primary:"ui-icon-circle-plus"},text:true});$("a.deletebtlist").button({icons:{primary:"ui-icon-circle-minus"},text:true});$("#targetdata li a").each(function(a){$(this).click(function(){var d=
$(this).data("viewer"),b=$("#targetdata"),c=b.find("tbody");c.find("tr."+d).show();c.find("tr:not(."+d+")").hide();d=b.find("li");d.attr("class","ui-state-default ui-corner-top");d.eq(a).attr("class","ui-state-default ui-corner-top ui-tabs-selected ui-state-active")})});$("#shopitemdata>ul>li>a").each(function(a){$(this).click(function(){var d=$(this).data("viewer");$("#view-type1").hide();$("#view-type2").hide();$("#view-type3").hide();$("#view-type4").hide();$("#view-type5").hide();$("#view-type6").hide();
$("#view-"+d).show();d=$("#shopitemdata>ul>li");d.attr("class","ui-state-default ui-corner-top");d.eq(a).attr("class","ui-state-default ui-corner-top ui-tabs-selected ui-state-active")})});$("#shopitemdata div li a").each(function(a){$(this).click(function(){var d=$(this).data("viewer");$("#id_shopcategory").val(d);grb.shopAjax();d=$("#shopitemdata").find("div").find("li");d.attr("class","ui-state-default ui-corner-top");d.eq(a).attr("class","ui-state-default ui-corner-top ui-tabs-selected ui-state-active")})});
for(i=0;i<5;i++)$('input[name="money-'+i+'-trade_number"]').change(this.calcMoney);browser.pc||$("#sidebar1").find("nav").accordion({header:"h4",heightStyle:"content",autoHeight:false,icons:false,collapsible:true,active:false});browser.android&&$("select").change(function(){this.style.display="none";var a=this;setTimeout(function(){a.style.display="inline-block"},0)});this.onReady!==arguments.callee&&this.onReady.apply(this)},onLoad:function(){},mark:{_response:function(a){$("#id_mark_id").empty();
var g=document.getElementById("id_mark_id"),d=0;$("#weabody").empty();for(key in a.marklist){g.options[d]=new Option(a.marklist[key][1],a.marklist[key][0]);if(a.weathers[0].length>0){$("#weather_button").data("title",$("#id_quest_id option:selected").text()+"\u306e\u5929\u6c17\u4e88\u5831");$("#weather_button").show();$("#weabody").append($("<tr>").append($("<td>").text(a.marklist[key][1])).append($("<td>").html("\u6b21\u306e\u5929\u6c17\u306f <strong>"+a.weathers[d][0]+"</strong> \u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002<br />\u7fcc\u9031\u306f <strong>"+
a.weathers[d][1]+"</strong> \u306b\u3002<br />\u7fcc\u3005\u9031\u306f <strong>"+a.weathers[d][2]+"</strong> \u306b\u306a\u308b\u898b\u8fbc\u307f\u3067\u3059\u3002")))}else $("#weather_button").hide();d++}}},shop:{_response:function(a){$("#shopbody").empty();for(key in a.itemlist)$("#shopbody").append($("<tr>").append($("<td>").attr("rowspan","2").text(a.itemlist[key].id)).append($("<td>").append($("<a>").attr("href","javascript:void(0)").addClass("apply-link").attr("data-dialog","shop_item").attr("data-id_value",
a.itemlist[key].id).attr("data-name_value",a.itemlist[key].name).text(a.itemlist[key].name).click(grb.applyLink))).append($("<td>").text(a.itemlist[key].it_price))).append($("<tr>").append($("<td>").attr("colspan","2").html(a.itemlist[key].it_comment)))}},good:{_response:function(a){$("#id_good_count_"+a.article_id).html(a.goodcount)}},markAjax:function(){quest_id=$("#id_quest_id").val();grb.response=false;$.ajax({async:true,url:"/continue/load_mark/"+quest_id+"/?"+(new Date).getTime(),cache:true,
dataType:"json",error:function(){browser.local||location.reload()},success:grb.mark._response,timeout:2E4})},shopAjax:function(){category_id=$("#id_shopcategory").val();grb.response=false;$.ajax({async:true,url:"/continue/load_shop/"+category_id+"/?"+(new Date).getTime(),cache:true,dataType:"json",error:function(){browser.local||location.reload()},success:grb.shop._response,timeout:2E4})},goodAjax:function(a){article_id=a;grb.response=false;$.ajax({async:true,url:"/forum/good/"+article_id+"/?"+(new Date).getTime(),
cache:true,dataType:"json",error:function(){browser.local||location.reload()},success:grb.good._response,timeout:2E4})},applyLink:function(){var a=$(this).data("dialog"),g=$("#dialog-"+a+' input[type="hidden"].ret_id').val(),d=$("#dialog-"+a+' input[type="hidden"].ret_value').val(),b=$("#dialog-"+a+' input[type="hidden"].ret_count').val(),c=$("#dialog-"+a+' input[type="hidden"].ret_money').val(),e=$(this).data("id_value"),f=$(this).data("name_value"),h=$(this).data("count_value"),j=$(this).data("money_value");
$("#"+g).val(e);$("#"+d).text(f);$("#"+b).text(h);$("#"+c).text(j);$("#dialog-"+a).dialog("close");grb.calcMoney()},calcMoney:function(){var a=parseInt($("#hide_havemoney").val());$('input[name="add_money"]').each(function(){add=parseInt($(this).val());isNaN(add)||(a=a+add)});$('input[name="minus_money"]').each(function(){minus=parseInt($(this).val());isNaN(minus)||(a=a-minus)});for(i=0;i<5;i++){tmp_money=parseInt($('input[name="money-'+i+'-trade_number"]').val());isNaN(tmp_money)||(a=a-tmp_money)}if(a<
0){a=a.toString().replace(/(\d)(?=(\d\d\d)+$)/g,"$1,");$("#id_havemoney").text(a).css("color","#f30")}else{a=a.toString().replace(/(\d)(?=(\d\d\d)+$)/g,"$1,");$("#id_havemoney").text(a).css("color","#D0D0D0")}},updateElementIndex:function(a,g,d){var b=RegExp("("+g+"-\\d+-)|(^)"),g=g+"-"+d+"-";a.attr("for")&&a.attr("for",a.attr("for").replace(b,g));a.attr("id")&&a.attr("id",a.attr("id").replace(b,g));a.attr("name")&&a.attr("name",a.attr("name").replace(b,g));a.attr("data-return_id")&&a.attr("data-return_id",
a.attr("data-return_id").replace(b,g));a.attr("data-return_value")&&a.attr("data-return_value",a.attr("data-return_value").replace(b,g))},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=true},hiddenImage:function(a){$("#"+a).val("http://www.grand-blaze.com/default.gif")},defaultImage:function(a){$("#"+a).val("http://www.grand-blaze.com/defimage.gif")}};var grb=new GrandBlaze;
